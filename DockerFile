# FROM --platform=linux/amd64 openjdk:17
# WORKDIR /server
# COPY ./src/server/java/project/ /server/
# RUN javac Server.java RequestHandler.java \ 
#           ChatGPT.java GPTInterface.java \
#           Whisper.java WhisperInterface.java \
#           MongoDBProject.java
# EXPOSE 8100
# ENTRYPOINT ["java", "server/Server"]


# temp container to build using gradle
FROM gradle:8.4-jdk17 AS GRADLE_BUILD
WORKDIR /src/server/java/project/
COPY . .
RUN gradle build
    
# Package stage
FROM --platform=linux/amd64 openjdk:17
ENV JAR_NAME=Server.jar
ENV APP_HOME=/src/server/java/project/
WORKDIR $APP_HOME
COPY --from=GRADLE_BUILD $APP_HOME .
EXPOSE 8100
ENTRYPOINT exec java -jar $APP_HOME/build/libs/$JAR_NAME  